<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Reader</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script>
      // Configure MathJax before it loads
      window.MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
          displayMath: [
            ["$$", "$$"],
            ["\\[", "\\]"],
          ],
          processEscapes: true,
          processEnvironments: true,
        },
        options: {
          skipHtmlTags: ["script", "noscript", "style", "textarea", "pre", "code"],
        },
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <link rel="stylesheet" href="/styling/blog.css" />
  </head>
  <body>
    <div class="header">
      <div>
        <h1>Isaac's Blog</h1>
      </div>
      <div class="header-actions">
        <button class="theme-button" id="theme-toggle" title="Toggle theme">ðŸŒ™</button>
      </div>
    </div>
    <div class="topics-container">
      <div class="topics-bar" id="topics-bar"></div>
    </div>

    <div class="main-container">
      <aside class="sidebar">
        <div class="sidebar-card">
          <h2>Recent Posts</h2>
          <ul class="blog-list" id="blog-list">
            <li class="loading">Loading posts...</li>
          </ul>
        </div>
      </aside>

      <main class="content">
        <div class="blog-card">
          <div id="blog-content" class="loading">Select a blog post to read</div>
        </div>
      </main>
    </div>

    <script>
      // Single Page Apps for GitHub Pages
      // https://github.com/rafgraph/spa-github-pages
      // This script checks to see if a redirect is present in the query string,
      // converts it back into the correct URL and adds it to the browser's history
      // using window.history.replaceState(...), which won't cause the browser to
      // attempt to load the new URL.
      (function (l) {
        if (l.search[1] === "/") {
          var decoded = l.search
            .slice(1)
            .split("&")
            .map(function (s) {
              return s.replace(/~and~/g, "&");
            })
            .filter((s) => s !== "")
            .join("?");

          // Use base path if available, otherwise default to root
          var basePath = (typeof window !== "undefined" && window.__BASE_PATH__) || "/";

          // Remove leading slash from decoded if present
          var path = decoded.startsWith("/") ? decoded.slice(1) : decoded;

          // If base path is not root, check if decoded path already starts with base path segments
          // (This can happen if the path was encoded with the base path included)
          if (basePath !== "/") {
            var basePathSegments = basePath.split("/").filter((s) => s.length > 0);
            var pathSegments = path.split("/").filter((s) => s.length > 0);

            // Check if path already starts with base path segments
            var startsWithBasePath =
              basePathSegments.length > 0 &&
              pathSegments.length >= basePathSegments.length &&
              basePathSegments.every((segment, i) => segment === pathSegments[i]);

            if (startsWithBasePath) {
              // Remove base path segments from the beginning
              path = pathSegments.slice(basePathSegments.length).join("/");
            }
          }

          // Construct restored path: basePath + path (with proper slash handling)
          var restoredPath;
          if (basePath === "/") {
            restoredPath = "/" + path;
          } else {
            // Ensure basePath doesn't have trailing slash, then add path with leading slash
            var normalizedBasePath = basePath.replace(/\/$/, "");
            restoredPath = normalizedBasePath + "/" + path;
          }

          // Normalize the path (remove double slashes)
          restoredPath = restoredPath.replace(/\/+/g, "/");

          // If path is empty (just base path), ensure it ends with a single slash
          // Otherwise, remove trailing slash for consistency
          if (path === "") {
            restoredPath = basePath === "/" ? "/" : basePath;
          } else {
            restoredPath = restoredPath.replace(/\/$/, "") || "/";
          }

          window.history.replaceState(null, null, restoredPath + l.hash);
        }
      })(window.location);
    </script>
    <script type="module" src="/src/blog.ts"></script>
  </body>
</html>
